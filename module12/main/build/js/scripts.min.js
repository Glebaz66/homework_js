"use strict";var template=document.querySelector(".js-template"),listCards=document.querySelector(".js-list-cards"),input=document.querySelector(".js-form input[type=text]"),form=document.querySelector(".js-form"),regUrl=/^((ftp|http|https):\/\/)?(www\.|)([A-z|0-9]+)\.([A-z]{2,})/,source=template.innerHTML.trim(),temp=Handlebars.compile(source),fetchUrl=function(e){return fetch("http://api.linkpreview.net/?key=5bb3d3d85d2689e5629a2de473cd5362919f9edc33853&q="+e).then(function(e){if(e.ok)return e.json();throw new Error("error")}).catch(function(e){return console.error(e)})};function handleFormSubmit(e){if(e.preventDefault(),!regUrl.test(input.value))return input.parentNode.reset(),alert("Невалидный URL! Попробуйте еще раз.");fetchUrl(input.value).then(function(e){if(null!==localStorage.getItem(e.url))return alert("Такая закладка уже есть!");localStorage.setItem(e.url,e.url);var t=temp(e);listCards.insertAdjacentHTML("afterbegin",t)}),input.parentNode.reset()}function handleDelBtn(e){e.preventDefault();var t=document.querySelector(".js-li-url");"BUTTON"===e.target.nodeName&&(localStorage.removeItem(t.name),e.target.parentElement.parentElement.remove())}Object.keys(localStorage).forEach(function(e){fetchUrl(e).then(function(e){listCards.insertAdjacentHTML("afterbegin",temp(e))})}),form.addEventListener("submit",handleFormSubmit),listCards.addEventListener("click",handleDelBtn);